<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2025-10-25</title>
  <link rel="stylesheet" href="/notes/style.css" />
</head>
<body>
  <header class="container py-24">
    <h1 class="title">2025-10-25</h1>
    <nav class="nav">
      <a href="/notes/daily-notes/index.html" class="nav-link">← 回分類</a>
      <a href="/notes/index.html" class="nav-link">回總覽</a>
    </nav>
  </header>

  <main class="container card">
    <article class="post-content">
      <h1 id="k8s">K8s</h1>
<h2 id="tls">TLS</h2>
<h1 id="_1">目錄</h1>
<p>加密方法介紹加密方法介紹</p>
<p>非對稱加密的兩種用途</p>
<p>總結</p>
<h1 id="_2">加密方法介紹加密方法介紹</h1>
<h2 id="symmetric-encryption">🔹 對稱式加密（Symmetric Encryption）</h2>
<p>🔸 使用同一把金鑰來「加密」與「解密」。</p>
<p>📦 範例：</p>
<p>金鑰：K
加密：Ciphertext = Encrypt(K, Plaintext)
解密：Plaintext = Decrypt(K, Ciphertext)</p>
<p>💡 意思是：</p>
<ul>
<li>
<p>傳送方與接收方要事先「共用」同一把金鑰 K；</p>
</li>
<li>
<p>拿到密文的人，只要知道 K，就能解出原文。</p>
</li>
</ul>
<p>🧩 舉例：</p>
<p>你用密碼壓縮一個 zip 檔給朋友，只要知道密碼（=金鑰）的人都能打開。</p>
<p>📌 缺點：</p>
<ul>
<li>難在「如何安全地把金鑰交給對方」。</li>
</ul>
<h2 id="asymmetric-encryption">🔹 非對稱式加密（Asymmetric Encryption）</h2>
<p>🔸 使用一對不同的金鑰：「公鑰 (Public Key)」與「私鑰 (Private Key)」。</p>
<p>這兩把金鑰互相關聯：</p>
<ul>
<li>
<p>用公鑰加密 → 只能用對應的私鑰解密。</p>
</li>
<li>
<p>用私鑰加密（簽章） → 只能用對應的公鑰驗證。</p>
</li>
</ul>
<p>📦 範例：</p>
<p>加密：Ciphertext = Encrypt(PublicKey, Plaintext)
解密：Plaintext = Decrypt(PrivateKey, Ciphertext)</p>
<p>💡 意思是：</p>
<ul>
<li>
<p>公鑰可以公開給全世界；</p>
</li>
<li>
<p>私鑰必須由擁有者自己保密；</p>
</li>
<li>
<p>即使知道公鑰，也不可能在可行時間內推算出私鑰（靠數學難題，例如大質數分解、橢圓曲線離散對數）。</p>
</li>
</ul>
<h1 id="_3">🧾 非對稱加密的「兩種用途」</h1>
<p>非對稱加密不只用來「加密資料」，還能用來「數位簽章」。</p>
<h1 id="_4">加密傳輸</h1>
<ul>
<li>
<p>非對稱加密（公鑰/私鑰）只在握手時用來驗身分與安全交換對稱金鑰。</p>
</li>
<li>
<p>對稱加密（同一把金鑰）在資料傳輸階段負責高效加解密。</p>
</li>
<li>
<p>現代網站使用 TLS 1.3 + ECDHE，具備前向安全。</p>
</li>
</ul>
<h2 id="_5">角色與名詞表</h2>
<ul>
<li>
<p>Client（用戶端）：你的瀏覽器或 App。</p>
</li>
<li>
<p>Server（伺服器）：網站 / API 端。</p>
</li>
<li>
<p>伺服器憑證：含伺服器公鑰與網域資訊，由 CA 簽發（身分證）。</p>
</li>
<li>
<p>CA（憑證機構）：大家信任的「發證機關」。</p>
</li>
<li>
<p>Session Key（會話金鑰）：對稱加密用的隨機金鑰，僅用於當次連線。</p>
</li>
<li>
<p>mTLS：雙向驗證，伺服器也要求客戶端出示憑證。</p>
</li>
</ul>
<h2 id="_6">交換對稱金鑰：兩種典型做法</h2>
<p>後續資料全靠對稱加密，所以這步是整個安全的關鍵。</p>
<h3 id="a-tls-12-rsa-key-transport">A. 傳統（TLS 1.2 的 RSA Key Transport，概念易懂）</h3>
<p>Client 產生一把隨機的 Session Key（對稱金鑰）。</p>
<p>用 伺服器公鑰 將這把 Session Key 加密。</p>
<p>傳給 Server。</p>
<p>Server 用自己的 私鑰 解開得到 Session Key。</p>
<p>之後雙方都知道同一把 Session Key → 改用對稱加密傳輸。</p>
<h3 id="b-tls-13-tls-12-ecdhe">B. 現代（TLS 1.3 / TLS 1.2 ECDHE，建議的）</h3>
<p>Client 與 Server 各自生成「臨時（ephemeral）公私鑰對」。</p>
<p>雙方交換臨時公鑰（就算被旁觀也無妨）。</p>
<p>利用 Diffie-Hellman 運算，各自計算出相同的共享祕密。</p>
<p>由共享祕密導出 Session Key。</p>
<p>好處：前向安全（就算未來伺服器私鑰外洩，也解不了今天的歷史流量）。</p>
<p>重點釐清：對稱加密沒有「公鑰」。對稱只有一把金鑰；</p>
<h2 id="mtls">（可選）mTLS：要求客戶端也證明「你是誰」</h2>
<ul>
<li>若伺服器回 CertificateRequest，代表要做雙向驗證：</li>
</ul>
<p>適用內網、金流、etcd/K8s 等高敏感情境。</p>
<h2 id="finished">Finished：切換到對稱加密的「安全通道」</h2>
<ul>
<li>
<p>雙方以 Session Key 對「握手完成」訊息加密與驗證，確認彼此能正確解密。</p>
</li>
<li>
<p>自此之後：所有 HTTP/HTTP2/HTTP3 的請求/回應都在對稱加密通道內進行（例如 AES、ChaCha20）。</p>
</li>
</ul>
<h2 id="_7">為什麼中間人拿不到明文？</h2>
<ul>
<li>
<p>握手時傳的是憑證（公鑰）或臨時公鑰，不是私鑰。</p>
</li>
<li>
<p>真正的 Session Key 不是明文傳的（RSA 方式被公鑰包起來；ECDHE 方式從私鑰計算來）。</p>
</li>
<li>
<p>沒有伺服器私鑰（RSA）或雙方臨時私鑰（ECDHE），旁觀者無法復原 Session Key，自然解不了密文。</p>
</li>
<li>
<p>TLS 1.3 + ECDHE 提供前向安全：就算往後某天金鑰外洩，歷史流量仍安全。</p>
</li>
</ul>
<h1 id="_8">為什麼光有加密還不夠？──數位簽章的角色</h1>
<p>當我們說「通訊加密」時，通常指的是端對端加密（End-to-End Encryption）：</p>
<p>資料在傳輸過程中被加密，即使中間人攔截，也看不到內容。</p>
<p>但這裡其實還有一個潛在的風險：</p>
<p>如果「對方是假的」呢？</p>
<p>這時候，再強的加密也沒用，因為你把祕密加密傳給了錯的人。</p>
<p>所以除了「保密（Confidentiality）」，</p>
<p>我們還需要一個機制能「驗證對方的身分（Authenticity）」──這就是 數位簽章（Digital Signature）。</p>
<h1 id="_9">數位簽章</h1>
<p>數位簽章是一種使用 非對稱加密 來保證：</p>
<p>訊息的發送者「確實是他本人」；</p>
<p>訊息在傳輸過程中「沒有被竄改」。</p>
<p>它的運作原理類似「電子版的手寫簽名」──</p>
<p>只是這裡簽的是一段資料的雜湊值（Hash），而不是名字。</p>
<h2 id="1">1. 簽章階段（由伺服器或訊息發送者完成）</h2>
    </article>
    <p class="post-meta">
      原文：
      <a href="https://github.com/Vincent23412/diary/blob/main/content/daily-notes/2025-10-25.md" target="_blank">GitHub</a> ·
      <a href="https://raw.githubusercontent.com/Vincent23412/diary/main/content/daily-notes/2025-10-25.md" target="_blank">raw</a>
    </p>
  </main>

  <footer class="container py-24">
    <small>最後更新：2025-11-01</small>
  </footer>
</body>
</html>
