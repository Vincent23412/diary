name: Daily Push Check

on:
  schedule:
    - cron: '0 14 * * *'  # å°ç£æ™‚é–“æ™šä¸Š 10 é» (UTC +8 = 14 UTC)
  workflow_dispatch: # æ‰‹å‹•è§¸ç™¼ä¹Ÿå¯ä»¥

jobs:
  check-push:
    runs-on: ubuntu-latest
    steps:
      - name: Check latest commit time
        id: check
        run: |
          REPO="ä½ çš„ GitHub ä½¿ç”¨è€…åç¨±/ä½ çš„ Repo åç¨±"
          TOKEN="${{ secrets.GITHUB_TOKEN }}"
          TODAY=$(date -u +%Y-%m-%d)
          COMMITS=$(curl -s -H "Authorization: token $TOKEN" https://api.github.com/repos/Vincent23412/diary/commits?since=${TODAY}T00:00:00Z)
          echo "Commits today: $COMMITS"
          if [[ "$COMMITS" == "[]" ]]; then
            echo "no_push=true" >> $GITHUB_OUTPUT
          else
            echo "no_push=false" >> $GITHUB_OUTPUT
          fi

      - name: Send email if no commit
        if: steps.check.outputs.no_push == 'true'
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp@gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: 'ğŸš¨ GitHub æœªå®Œæˆä»Šæ—¥é€²åº¦ï¼'
          body: "ä»Šå¤©å°šæœª pushï¼è«‹åœ¨ 23:59 å‰è£œä¸Šæ¯æ—¥é€²åº¦ï¼"
          to: ä½ çš„email@gmail.com
          from: 'GitHub Monitor <asd1111zxcv@gmail.com>'
