# GitHub Actions å•é¡Œç­†è¨˜

### ğŸ“Œ å•é¡Œä¸€ï¼šDocker container æ¯æ¬¡éƒ½é‡æ–°å®‰è£ä¾è³´ï¼ˆå¦‚ Go modulesï¼‰

## ç¾è±¡


åœ¨ GitHub Actions çš„ CI/CD pipeline ä¸­ï¼Œå¾Œç«¯æœå‹™ä½¿ç”¨ `go run` æˆ– `go build` æŒ‡ä»¤åŸ·è¡Œæ™‚ï¼ŒGo modules æ¯æ¬¡éƒ½æœƒé‡æ–°ä¸‹è¼‰ï¼Œå°è‡´ workflow æ™‚é–“è®Šé•·ã€‚

## è§£æ±ºæ–¹æ¡ˆ


- ä½¿ç”¨ [actions/cache](https://github.com/actions/cache) å„²å­˜ `$GOPATH/pkg/mod` å’Œ `go.sum` çš„å¿«å–ã€‚

 ç¯„ä¾‹ï¼š


  - name: Cache Go modules
    uses: actions/cache@v3
    with:
      path: |
        ~/.cache/go-build
        ~/go/pkg/mod
      key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
      restore-keys: |
        ${{ runner.os }}-go-


## ğŸ“Œ å•é¡ŒäºŒï¼šDocker Compose åŸ·è¡Œå¤±æ•—æˆ–æ‰¾ä¸åˆ° volume ç›®éŒ„

### ç¾è±¡

åœ¨ GitHub Actions åŸ·è¡Œ docker-compose up æ™‚å‡ºç¾ volume mount éŒ¯èª¤ï¼Œæˆ–å ±éŒ¯æ‰¾ä¸åˆ°æŸäº›ç›®éŒ„ã€‚

### è§£æ±ºæ–¹æ¡ˆ

- ç¢ºä¿å°ˆæ¡ˆè³‡æ–™å¤¾çµæ§‹æ­£ç¢ºï¼Œä¸¦ä¸”æ‰€æœ‰ volume æŒ‡çš„è³‡æ–™å¤¾ï¼ˆå¦‚ ./pgadminï¼‰åœ¨ repo ä¸­å­˜åœ¨ï¼Œå¦å‰‡é è¨­æœƒæ›è¼‰ç©ºè³‡æ–™å¤¾ã€‚

- è‹¥ç‚ºæš«æ™‚è³‡æ–™ï¼Œå¯è€ƒæ…®ä½¿ç”¨ ephemeral volumeï¼Œä¾‹å¦‚ï¼š

## ğŸ“Œ å•é¡Œä¸‰ï¼šContainer å•Ÿå‹•ä½†ç„¡æ³•é€£ç·šï¼ˆå¦‚ ECONNREFUSEDï¼‰

### ç¾è±¡

å‰ç«¯åœ¨ proxy API æ™‚ç„¡æ³•é€£åˆ°å¾Œç«¯ï¼Œå¦‚ connect ECONNREFUSED æˆ– getaddrinfo ENOTFOUND dashboard-be

### è§£æ±ºæ–¹æ¡ˆ

- ç¢ºèª docker-compose.yml ä¸­çš„ container nameã€port å’Œ service name æ˜¯å¦ä¸€è‡´ã€‚

- åœ¨æœ¬åœ°é–‹ç™¼æ™‚ï¼Œè‹¥æ‰‹å‹•å•Ÿå‹•æŸäº›æœå‹™ï¼Œå»ºè­°ä½¿ç”¨ Docker network æª¢æŸ¥é€£ç·šï¼š

## ğŸ“Œ å•é¡Œå››ï¼špgAdmin å„²å­˜ç›®éŒ„ç„¡æ¬Šé™æˆ–æœªæ›è¼‰æˆåŠŸ

### ç¾è±¡

å•Ÿå‹• pgAdmin container å¾Œï¼Œç™¼ç¾è¨­å®šç„¡æ³•ä¿å­˜ï¼Œæˆ–è³‡æ–™å¤¾æ¬Šé™éŒ¯èª¤ã€‚

### è§£æ±ºæ–¹æ¡ˆ

- æ›è¼‰çš„æœ¬æ©Ÿç›®éŒ„éœ€ç¢ºä¿æ“æœ‰è€…ç‚ºå®¹å™¨ä¸­çš„ pgadmin ç”¨æˆ¶ï¼ˆé€šå¸¸ç‚º UID 5050ï¼‰

- ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¿®æ­£æ¬Šé™ï¼š

## ğŸ“Œ å‚™è¨»

- æ¯æ¬¡éƒ¨ç½²å®Œå¯ç”¨ docker compose down æ¸…æ‰æœå‹™ï¼Œä½†è¨˜å¾—è³‡æ–™ volume è‹¥æ²’ä¿ç•™æœƒæ¸…ç©ºè³‡æ–™ã€‚

- è‹¥ workflow å¡ä½å»ºè­°åŠ ä¸Š debug log æˆ–ä½¿ç”¨ -verbose æŸ¥åŸå› ã€‚

# ğŸ“˜ GitHub Actions å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ³•æ•´ç†

## ğŸ“¦ ä»»å‹™èƒŒæ™¯

é€é GitHub Actions è‡ªå‹•åŸ·è¡Œ sync_notion.py ä¸¦å°‡æ¯æ—¥ç­†è¨˜æ¨é€åˆ° GitHub ä¸Šï¼Œå¸¸è¦‹éŒ¯èª¤å¦‚ä¸‹ï¼š

## ğŸš« Permission denied to github-actions[bot]

### â— éŒ¯èª¤è¨Šæ¯ï¼š

remote: Permission to <repo>.git denied to github-actions[bot].
fatal: unable to access 'https://github.com/<repo>.git/': The requested URL returned error: 403


### âœ… åŸå› èˆ‡è§£æ³•ï¼š

- åŸå› ï¼šé è¨­ github-actions[bot] ç„¡æ¬Š push åˆ°ç§äººæˆ–ç‰¹å®š repoã€‚

- è§£æ³•ï¼šå»ºç«‹ Personal Access Tokenï¼ˆPATï¼‰ï¼Œä¸¦æ–°å¢ç‚º secretsï¼š

## ğŸ” Updates were rejected because the remote contains work

### â— éŒ¯èª¤è¨Šæ¯ï¼š

Updates were rejected because the remote contains work that you do not have locally.

### âœ… åŸå› èˆ‡è§£æ³•ï¼š

- åŸå› ï¼šé ç«¯åˆ†æ”¯æœ‰æ›´æ–°ï¼Œä½†æœ¬åœ°åˆ†æ”¯å°šæœªåŒæ­¥ã€‚

- è§£æ³• 1ï¼šè‹¥å¯æ¥å—è¦†è“‹ï¼š

- è§£æ³• 2ï¼šè‹¥éœ€ä¿ç•™é ç«¯è®Šæ›´ï¼š

## ğŸ§ª No upstream branch

### â— éŒ¯èª¤è¨Šæ¯ï¼š

fatal: The current branch main has no upstream branch.

### âœ… è§£æ³•ï¼š

git push --set-upstream origin main

## ğŸ” ç„¡æ³•é©—è­‰ remote URL æœ‰å¥—ç”¨ Token

### ğŸ” é©—è­‰æ–¹æ³•ï¼š

git remote -v


æ­£ç¢ºçµæœæ‡‰é¡ä¼¼ï¼š

origin  https://x-access-token:<GH_PAT>@github.com/<user>/<repo> (fetch)
origin  https://x-access-token:<GH_PAT>@github.com/<user>/<repo> (push)


## ğŸ”‘ Token é–‹é ­æ ¼å¼

- Fine-grained Token ä¸€èˆ¬ç‚º github_pat_ é–‹é ­ï¼Œé€™æ˜¯æ­£å¸¸çš„ã€‚

- è‹¥æ ¼å¼ç‚º ghp_ å‰‡ç‚º classic tokenã€‚

## ğŸ” Debug å»ºè­°

ä½ å¯ä»¥å®‰å…¨å°å‡ºéƒ¨åˆ†è®Šæ•¸å€¼å”åŠ© debugï¼š

echo "GH_PAT starts with: ${GH_PAT:0:6}******"
echo "REPO is $GITHUB_REPOSITORY"


## âœ… å»ºè­°åšæ³•ï¼šé‡è¨­ Remote + Force Push

git remote remove origin
git remote add origin https://x-access-token:${GH_PAT}@github.com/${GITHUB_REPOSITORY}
git push origin main --force


## ğŸ§  è£œå……å»ºè­°

- å¼·åˆ¶ push é¢¨éšªé«˜ï¼Œå»ºè­° æ¯æ—¥ç­†è¨˜è¨˜éŒ„å°ˆç”¨ branch ä½¿ç”¨ã€‚

- è‹¥è¦é¿å… forceï¼Œå¯åœ¨ CI åŠ å…¥ git pull --rebase æˆ– fetch å†æ¯”å°ã€‚