æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š

ğŸ‘‰ C. Use Reserved Instances for the baseline capacity and use Spot Instances to handle additional capacity

ğŸ’¡ è§£é‡‹ï¼š

é€™é¡Œçš„é—œéµæ˜¯è¦æ‰¾å‡ºä¸€å€‹ é«˜å¯ç”¨ã€å…·æˆæœ¬æ•ˆç›Šï¼ˆMOST cost-effectiveï¼‰ çš„ EC2 é‹è¡Œæ¨¡å¼ï¼Œä¾†æ‡‰å°ï¼š

- æŒçºŒæ€§è™•ç†éœ€æ±‚ï¼ˆno downtimeï¼‰

- ä¸ç©©å®šçš„è¨Šæ¯æµé‡ï¼ˆintermittent trafficï¼‰

- å¯ä½µè¡Œè™•ç†ä»»å‹™ï¼ˆparallel processingï¼‰

âœ… æœ€ä½³è§£æ³•ï¼š

Reserved + Spot çµ„åˆ

- Reserved Instances (RI)ï¼š

- 

- Spot Instancesï¼š

- 

è‹¥ Spot è¢«å›æ”¶ï¼ŒReserved ä»å¯ä¿åº•ç¶­æŒæœå‹™ä¸ä¸­æ–·ï¼Œæˆæœ¬æ•ˆç›Šèˆ‡å¯ç”¨æ€§å…¼å…·

âŒ å…¶ä»–é¸é …ç‚ºä»€éº¼ä¸é©åˆï¼Ÿ

âœ… æ­£ç¢ºç­”æ¡ˆï¼šC. Use Reserved Instances for the baseline capacity and use Spot Instances to handle additional capacity

æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š

ğŸ‘‰ C. Create an Amazon EventBridge (Amazon CloudWatch Events) rule for the Createlmage API call. Configure the target as an Amazon Simple Notification Service (Amazon SNS) topic to send an alert when a Createlmage API call is detected.

âœ… è§£é‡‹ï¼š

ç‚ºä»€éº¼é¸ Cï¼Ÿ

- Amazon EventBridgeï¼ˆåŸå CloudWatch Eventsï¼‰ å¯ä»¥å³æ™‚ç›£è½ç‰¹å®šçš„ AWS API å‘¼å«äº‹ä»¶ï¼ˆä¾‹å¦‚ EC2 çš„ CreateImageï¼‰ã€‚

- ä½ å¯ä»¥è¨­å®šè¦å‰‡ä¾†åµæ¸¬é€™å€‹ API äº‹ä»¶ï¼Œä¸¦å°‡äº‹ä»¶å‚³é€çµ¦ Amazon SNSï¼Œç™¼å‡ºé€šçŸ¥ï¼ˆä¾‹å¦‚ Emailã€SMSã€Lambda ç­‰ï¼‰ã€‚

- ä¸éœ€è¦è‡ªå·±æŸ¥ CloudTrail logã€å¯« Lambda åˆ†æç¨‹å¼æˆ–æ’ç¨‹ä»»å‹™ï¼Œè‡ªå‹•ä¸”é›¶ç¶­é‹è² æ“”ã€‚

é€™æ˜¯ AWS å®˜æ–¹æ¨è–¦çš„æœ€è¼•é‡ã€æœ€å³æ™‚çš„äº‹ä»¶ç›£æ§æ–¹æ¡ˆã€‚

âŒ ç‚ºä»€éº¼å…¶ä»–é¸é …ä¸é©åˆï¼Ÿ

ğŸ§© å°è£œå……ï¼šEventBridge + SNS çš„å¥½è™•

- â± å³æ™‚åµæ¸¬ CreateImage

- ğŸ“‰ æœ€å°é‹ç®—æˆæœ¬

- ğŸ”§ å¹¾ä¹ç„¡é ˆç¨‹å¼ç¢¼

- ğŸ“¬ æ”¯æ´å¤šç¨®é€šçŸ¥æ–¹å¼ï¼ˆEmailã€Lambdaã€HTTP ç­‰ï¼‰

âœ… æ­£ç¢ºç­”æ¡ˆï¼šC. ä½¿ç”¨ EventBridge è¨­å®šç›£è½ Createlmageï¼Œä¸¦é€é SNS ç™¼é€è­¦å ±ã€‚

æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š

ğŸ‘‰ B. Create a gateway VPC endpoint for Amazon S3 in the Availability Zone where the EC2 instance is located. Attach appropriate security groups to the endpoint. Attach a resource policy to the S3 bucket to only allow the EC2 instanceâ€™s IAM role for access.

âœ… è§£é‡‹ï¼š

å•é¡Œæ ¸å¿ƒéœ€æ±‚ï¼š

è³‡æ–™ä¸Šå‚³ä¸èƒ½ç¶“éå…¬ç¶²ï¼ˆNo public internet routesï¼‰

åªæœ‰ EC2 instance æ‰èƒ½ä¸Šå‚³

ç›®æ¨™æœå‹™æ˜¯ Amazon S3

ğŸ§© æœ€é©è§£ï¼š

Gateway VPC Endpoint + IAM Role é™åˆ¶

- Gateway VPC Endpoint æ˜¯ S3 èˆ‡ DynamoDB å°ˆç”¨çš„ VPC Endpointï¼Œå…è¨± EC2 èˆ‡ S3 é–“çš„é€šè¨Šèµ°å…§éƒ¨ AWS ç¶²è·¯ï¼ˆç„¡éœ€ NAT Gateway æˆ– Internet Gatewayï¼‰ã€‚

- æ­é… S3 Bucket Policy é™å®šåªæœ‰ç‰¹å®š IAM Roleï¼ˆä¹Ÿå°±æ˜¯ EC2 çš„ instance profileï¼‰èƒ½ä¸Šå‚³ã€‚

é€™ç¨®è¨­è¨ˆï¼š

- ä¸ç¶“éå…¬ç¶²

- æˆæœ¬æœ€ä½ï¼ˆä¸ç”¨ NATï¼‰

- æ˜“æ–¼ç®¡æ§èˆ‡ç¶­é‹

âŒ ç‚ºä»€éº¼å…¶ä»–é¸é …ä¸å°ï¼Ÿ

ğŸ” å®‰å…¨æ€§è£œå……å»ºè­°ï¼š

- åœ¨ S3 Bucket Policy åŠ å…¥ï¼š

- 

âœ… æ­£ç¢ºç­”æ¡ˆï¼šB. ä½¿ç”¨ Gateway VPC Endpoint æ­é… IAM Role é™åˆ¶ï¼Œç¢ºä¿å®‰å…¨èˆ‡ç§æœ‰é€šè¨Šã€‚

ğŸŒ‰ Gateway Endpoint vs. Interface Endpoint å·®ç•°ç¸½è¦½

ğŸ” æ›´å…·é«”ç¯„ä¾‹æ¯”è¼ƒ

Gateway Endpoint

ï¼ˆå¦‚ S3ï¼‰ï¼š

- ä½ å»ºç«‹ä¸€å€‹ Gateway Endpoint

- å®ƒæœƒå¹«ä½ åœ¨ Route Table ä¸­è‡ªå‹•åŠ å…¥ä¸€æ¢è·¯ç”±ï¼š

Destination: pl-xxxx (S3 Prefix List) â†’ Target: vpce-xxxx

- 

- åªè¦ EC2 åœ¨é€™å€‹ Subnet ä¸­ï¼Œè«‹æ±‚ s3.amazonaws.com æœƒè‡ªå‹•èµ°ç§ç¶²ã€‚

Interface Endpoint

ï¼ˆå¦‚ SQSï¼‰ï¼š

- å»ºç«‹æ™‚æœƒåœ¨ Subnet ä¸­ç”Ÿæˆä¸€å€‹ ENIï¼ˆå½ˆæ€§ç¶²å¡ï¼‰

- æ‰€æœ‰è«‹æ±‚æœƒå°å‘é€™å€‹ ENIï¼Œä¾‹å¦‚ï¼š

sqs.ap-northeast-1.vpce.amazonaws.com â†’ 10.0.2.35ï¼ˆENI IPï¼‰

- 

- å¯ä»¥ç”¨ Security Group æ§ç®¡èª°å¯ä»¥å­˜å–å®ƒ

âœ… ä»€éº¼æ™‚å€™ç”¨å“ªå€‹ï¼Ÿ

ğŸ“Œ ç¸½çµ

æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š

ğŸ‘‰ A. Configure the Lambda function to run in the VPC with the appropriate security group.

âœ… è§£é‡‹ï¼š

å•é¡Œé—œéµï¼š

- Lambda è¦å­˜å– åœ¨å…¬å¸è³‡æ–™ä¸­å¿ƒï¼ˆon-premisesï¼‰å…§éƒ¨ç§æœ‰å­ç¶²ä¸­çš„è³‡æ–™åº«

- AWS èˆ‡è³‡æ–™ä¸­å¿ƒä¹‹é–“å·²é€é Direct Connect å»ºç«‹é€£ç·š

- è¦æ±‚ Lambda å¯ä»¥é€éç§æœ‰ç¶²è·¯ï¼ˆéå…¬ç¶²ï¼‰å­˜å–è³‡æ–™åº«

âœ… ç‚ºä»€éº¼é¸ Aï¼Ÿ

- Lambda é è¨­é‹è¡Œåœ¨ AWS å…¬ç¶²ä¸­ï¼Œå¦‚æœè¦å­˜å–ç§æœ‰ç¶²æ®µï¼ˆVPC å­ç¶²ã€æˆ–é€é Direct Connect é€£åˆ° on-premï¼‰ï¼Œå¿…é ˆé…ç½® Lambda é‹è¡Œåœ¨ VPC ä¸­

- è¨­å®š Lambda çš„ VPC å­ç¶²èˆ‡å®‰å…¨ç¾¤çµ„ï¼Œå°±èƒ½è®“ Lambdaï¼š

- 

- å®Œå…¨ç¬¦åˆç„¡ä¼ºæœå™¨ + ç§ç¶²å­˜å–çš„æ¶æ§‹éœ€æ±‚

âŒ å…¶ä»–é¸é …ç‚ºä»€éº¼ä¸é©åˆï¼Ÿ

ğŸ§© è£œå……å»ºè­°ï¼š

è‹¥ Lambda æ˜¯å­˜å– è³‡æ–™ä¸­å¿ƒå…§éƒ¨çš„ç§æœ‰è³‡æ–™åº«ï¼Œä½ éœ€è¦ï¼š

è®“ Lambda åŠ å…¥ VPCï¼ˆé¸å®šæœ‰è·¯ç”±åˆ° VGW çš„ç§æœ‰å­ç¶²ï¼‰

è¨­å®š Lambda ä½¿ç”¨çš„ security group â†’ é–‹å•Ÿå°è³‡æ–™åº«çš„é€£ç·šæ¬Šé™ï¼ˆä¾‹å¦‚ TCP 3306 for MySQLï¼‰

ç¢ºä¿ VPC route table æœ‰æŒ‡å‘ Virtual Private Gatewayï¼ˆVGWï¼‰

ç¢ºä¿å°æ–¹è³‡æ–™ä¸­å¿ƒçš„é˜²ç«ç‰†èˆ‡è·¯ç”±è¨­å®šä¹Ÿå…è¨± Lambda çš„ VPC IP ç¯„åœé€²å…¥