<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2025-06-03</title>
  <link rel="stylesheet" href="/notes/style.css" />
</head>
<body>
  <header class="container py-24">
    <h1 class="title">2025-06-03</h1>
    <nav class="nav">
      <a href="/notes/daily-notes/index.html" class="nav-link">← 回分類</a>
      <a href="/notes/index.html" class="nav-link">回總覽</a>
    </nav>
  </header>

  <main class="container card">
    <article class="post-content">
      <h1 id="github-actions">GitHub Actions 問題筆記</h1>
<h3 id="docker-container-go-modules">📌 問題一：Docker container 每次都重新安裝依賴（如 Go modules）</h3>
<h2 id="_1">現象</h2>
<p>在 GitHub Actions 的 CI/CD pipeline 中，後端服務使用 <code>go run</code> 或 <code>go build</code> 指令執行時，Go modules 每次都會重新下載，導致 workflow 時間變長。</p>
<h2 id="_2">解決方案</h2>
<ul>
<li>使用 <a href="https://github.com/actions/cache">actions/cache</a> 儲存 <code>$GOPATH/pkg/mod</code> 和 <code>go.sum</code> 的快取。</li>
</ul>
<p>範例：</p>
<ul>
<li>name: Cache Go modules
    uses: actions/cache@v3
    with:
      path: |
        ~/.cache/go-build
        ~/go/pkg/mod
      key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
      restore-keys: |
        ${{ runner.os }}-go-</li>
</ul>
<h2 id="docker-compose-volume">📌 問題二：Docker Compose 執行失敗或找不到 volume 目錄</h2>
<h3 id="_3">現象</h3>
<p>在 GitHub Actions 執行 docker-compose up 時出現 volume mount 錯誤，或報錯找不到某些目錄。</p>
<h3 id="_4">解決方案</h3>
<ul>
<li>
<p>確保專案資料夾結構正確，並且所有 volume 指的資料夾（如 ./pgadmin）在 repo 中存在，否則預設會掛載空資料夾。</p>
</li>
<li>
<p>若為暫時資料，可考慮使用 ephemeral volume，例如：</p>
</li>
</ul>
<h2 id="container-econnrefused">📌 問題三：Container 啟動但無法連線（如 ECONNREFUSED）</h2>
<h3 id="_5">現象</h3>
<p>前端在 proxy API 時無法連到後端，如 connect ECONNREFUSED 或 getaddrinfo ENOTFOUND dashboard-be</p>
<h3 id="_6">解決方案</h3>
<ul>
<li>
<p>確認 docker-compose.yml 中的 container name、port 和 service name 是否一致。</p>
</li>
<li>
<p>在本地開發時，若手動啟動某些服務，建議使用 Docker network 檢查連線：</p>
</li>
</ul>
<h2 id="pgadmin">📌 問題四：pgAdmin 儲存目錄無權限或未掛載成功</h2>
<h3 id="_7">現象</h3>
<p>啟動 pgAdmin container 後，發現設定無法保存，或資料夾權限錯誤。</p>
<h3 id="_8">解決方案</h3>
<ul>
<li>
<p>掛載的本機目錄需確保擁有者為容器中的 pgadmin 用戶（通常為 UID 5050）</p>
</li>
<li>
<p>使用以下指令修正權限：</p>
</li>
</ul>
<h2 id="_9">📌 備註</h2>
<ul>
<li>
<p>每次部署完可用 docker compose down 清掉服務，但記得資料 volume 若沒保留會清空資料。</p>
</li>
<li>
<p>若 workflow 卡住建議加上 debug log 或使用 -verbose 查原因。</p>
</li>
</ul>
<h1 id="github-actions_1">📘 GitHub Actions 常見錯誤與解法整理</h1>
<h2 id="_10">📦 任務背景</h2>
<p>透過 GitHub Actions 自動執行 sync_notion.py 並將每日筆記推送到 GitHub 上，常見錯誤如下：</p>
<h2 id="permission-denied-to-github-actionsbot">🚫 Permission denied to github-actions[bot]</h2>
<h3 id="_11">❗ 錯誤訊息：</h3>
<p>remote: Permission to <repo>.git denied to github-actions[bot].
fatal: unable to access 'https://github.com/<repo>.git/': The requested URL returned error: 403</p>
<h3 id="_12">✅ 原因與解法：</h3>
<ul>
<li>
<p>原因：預設 github-actions[bot] 無權 push 到私人或特定 repo。</p>
</li>
<li>
<p>解法：建立 Personal Access Token（PAT），並新增為 secrets：</p>
</li>
</ul>
<h2 id="updates-were-rejected-because-the-remote-contains-work">🔁 Updates were rejected because the remote contains work</h2>
<h3 id="_13">❗ 錯誤訊息：</h3>
<p>Updates were rejected because the remote contains work that you do not have locally.</p>
<h3 id="_14">✅ 原因與解法：</h3>
<ul>
<li>
<p>原因：遠端分支有更新，但本地分支尚未同步。</p>
</li>
<li>
<p>解法 1：若可接受覆蓋：</p>
</li>
<li>
<p>解法 2：若需保留遠端變更：</p>
</li>
</ul>
<h2 id="no-upstream-branch">🧪 No upstream branch</h2>
<h3 id="_15">❗ 錯誤訊息：</h3>
<p>fatal: The current branch main has no upstream branch.</p>
<h3 id="_16">✅ 解法：</h3>
<p>git push --set-upstream origin main</p>
<h2 id="remote-url-token">🔐 無法驗證 remote URL 有套用 Token</h2>
<h3 id="_17">🔍 驗證方法：</h3>
<p>git remote -v</p>
<p>正確結果應類似：</p>
<p>origin  https://x-access-token:<GH_PAT>@github.com/<user>/<repo> (fetch)
origin  https://x-access-token:<GH_PAT>@github.com/<user>/<repo> (push)</p>
<h2 id="token">🔑 Token 開頭格式</h2>
<ul>
<li>
<p>Fine-grained Token 一般為 github_pat_ 開頭，這是正常的。</p>
</li>
<li>
<p>若格式為 ghp_ 則為 classic token。</p>
</li>
</ul>
<h2 id="debug">🔍 Debug 建議</h2>
<p>你可以安全印出部分變數值協助 debug：</p>
<p>echo "GH_PAT starts with: ${GH_PAT:0:6}<strong>*</strong>*"
echo "REPO is $GITHUB_REPOSITORY"</p>
<h2 id="remote-force-push">✅ 建議做法：重設 Remote + Force Push</h2>
<p>git remote remove origin
git remote add origin https://x-access-token:${GH_PAT}@github.com/${GITHUB_REPOSITORY}
git push origin main --force</p>
<h2 id="_18">🧠 補充建議</h2>
<ul>
<li>
<p>強制 push 風險高，建議 每日筆記記錄專用 branch 使用。</p>
</li>
<li>
<p>若要避免 force，可在 CI 加入 git pull --rebase 或 fetch 再比對。</p>
</li>
</ul>
    </article>
    <p class="post-meta">
      原文：
      <a href="https://github.com/Vincent23412/diary/blob/main/content/daily-notes/2025-06-03.md" target="_blank">GitHub</a> ·
      <a href="https://raw.githubusercontent.com/Vincent23412/diary/main/content/daily-notes/2025-06-03.md" target="_blank">raw</a>
    </p>
  </main>

  <footer class="container py-24">
    <small>最後更新：2025-10-29</small>
  </footer>
</body>
</html>
