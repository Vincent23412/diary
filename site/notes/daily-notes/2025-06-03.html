<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2025-06-03</title>
  <link rel="stylesheet" href="/notes/style.css" />
</head>
<body>
  <header class="container py-24">
    <h1 class="title">2025-06-03</h1>
    <nav class="nav">
      <a href="/notes/daily-notes/index.html" class="nav-link">â† å›åˆ†é¡</a>
      <a href="/notes/index.html" class="nav-link">å›ç¸½è¦½</a>
    </nav>
  </header>

  <main class="container card">
    <article class="post-content">
      <h1 id="github-actions">GitHub Actions å•é¡Œç­†è¨˜</h1>
<h3 id="docker-container-go-modules">ğŸ“Œ å•é¡Œä¸€ï¼šDocker container æ¯æ¬¡éƒ½é‡æ–°å®‰è£ä¾è³´ï¼ˆå¦‚ Go modulesï¼‰</h3>
<h2 id="_1">ç¾è±¡</h2>
<p>åœ¨ GitHub Actions çš„ CI/CD pipeline ä¸­ï¼Œå¾Œç«¯æœå‹™ä½¿ç”¨ <code>go run</code> æˆ– <code>go build</code> æŒ‡ä»¤åŸ·è¡Œæ™‚ï¼ŒGo modules æ¯æ¬¡éƒ½æœƒé‡æ–°ä¸‹è¼‰ï¼Œå°è‡´ workflow æ™‚é–“è®Šé•·ã€‚</p>
<h2 id="_2">è§£æ±ºæ–¹æ¡ˆ</h2>
<ul>
<li>ä½¿ç”¨ <a href="https://github.com/actions/cache">actions/cache</a> å„²å­˜ <code>$GOPATH/pkg/mod</code> å’Œ <code>go.sum</code> çš„å¿«å–ã€‚</li>
</ul>
<p>ç¯„ä¾‹ï¼š</p>
<ul>
<li>name: Cache Go modules
    uses: actions/cache@v3
    with:
      path: |
        ~/.cache/go-build
        ~/go/pkg/mod
      key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
      restore-keys: |
        ${{ runner.os }}-go-</li>
</ul>
<h2 id="docker-compose-volume">ğŸ“Œ å•é¡ŒäºŒï¼šDocker Compose åŸ·è¡Œå¤±æ•—æˆ–æ‰¾ä¸åˆ° volume ç›®éŒ„</h2>
<h3 id="_3">ç¾è±¡</h3>
<p>åœ¨ GitHub Actions åŸ·è¡Œ docker-compose up æ™‚å‡ºç¾ volume mount éŒ¯èª¤ï¼Œæˆ–å ±éŒ¯æ‰¾ä¸åˆ°æŸäº›ç›®éŒ„ã€‚</p>
<h3 id="_4">è§£æ±ºæ–¹æ¡ˆ</h3>
<ul>
<li>
<p>ç¢ºä¿å°ˆæ¡ˆè³‡æ–™å¤¾çµæ§‹æ­£ç¢ºï¼Œä¸¦ä¸”æ‰€æœ‰ volume æŒ‡çš„è³‡æ–™å¤¾ï¼ˆå¦‚ ./pgadminï¼‰åœ¨ repo ä¸­å­˜åœ¨ï¼Œå¦å‰‡é è¨­æœƒæ›è¼‰ç©ºè³‡æ–™å¤¾ã€‚</p>
</li>
<li>
<p>è‹¥ç‚ºæš«æ™‚è³‡æ–™ï¼Œå¯è€ƒæ…®ä½¿ç”¨ ephemeral volumeï¼Œä¾‹å¦‚ï¼š</p>
</li>
</ul>
<h2 id="container-econnrefused">ğŸ“Œ å•é¡Œä¸‰ï¼šContainer å•Ÿå‹•ä½†ç„¡æ³•é€£ç·šï¼ˆå¦‚ ECONNREFUSEDï¼‰</h2>
<h3 id="_5">ç¾è±¡</h3>
<p>å‰ç«¯åœ¨ proxy API æ™‚ç„¡æ³•é€£åˆ°å¾Œç«¯ï¼Œå¦‚ connect ECONNREFUSED æˆ– getaddrinfo ENOTFOUND dashboard-be</p>
<h3 id="_6">è§£æ±ºæ–¹æ¡ˆ</h3>
<ul>
<li>
<p>ç¢ºèª docker-compose.yml ä¸­çš„ container nameã€port å’Œ service name æ˜¯å¦ä¸€è‡´ã€‚</p>
</li>
<li>
<p>åœ¨æœ¬åœ°é–‹ç™¼æ™‚ï¼Œè‹¥æ‰‹å‹•å•Ÿå‹•æŸäº›æœå‹™ï¼Œå»ºè­°ä½¿ç”¨ Docker network æª¢æŸ¥é€£ç·šï¼š</p>
</li>
</ul>
<h2 id="pgadmin">ğŸ“Œ å•é¡Œå››ï¼špgAdmin å„²å­˜ç›®éŒ„ç„¡æ¬Šé™æˆ–æœªæ›è¼‰æˆåŠŸ</h2>
<h3 id="_7">ç¾è±¡</h3>
<p>å•Ÿå‹• pgAdmin container å¾Œï¼Œç™¼ç¾è¨­å®šç„¡æ³•ä¿å­˜ï¼Œæˆ–è³‡æ–™å¤¾æ¬Šé™éŒ¯èª¤ã€‚</p>
<h3 id="_8">è§£æ±ºæ–¹æ¡ˆ</h3>
<ul>
<li>
<p>æ›è¼‰çš„æœ¬æ©Ÿç›®éŒ„éœ€ç¢ºä¿æ“æœ‰è€…ç‚ºå®¹å™¨ä¸­çš„ pgadmin ç”¨æˆ¶ï¼ˆé€šå¸¸ç‚º UID 5050ï¼‰</p>
</li>
<li>
<p>ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ä¿®æ­£æ¬Šé™ï¼š</p>
</li>
</ul>
<h2 id="_9">ğŸ“Œ å‚™è¨»</h2>
<ul>
<li>
<p>æ¯æ¬¡éƒ¨ç½²å®Œå¯ç”¨ docker compose down æ¸…æ‰æœå‹™ï¼Œä½†è¨˜å¾—è³‡æ–™ volume è‹¥æ²’ä¿ç•™æœƒæ¸…ç©ºè³‡æ–™ã€‚</p>
</li>
<li>
<p>è‹¥ workflow å¡ä½å»ºè­°åŠ ä¸Š debug log æˆ–ä½¿ç”¨ -verbose æŸ¥åŸå› ã€‚</p>
</li>
</ul>
<h1 id="github-actions_1">ğŸ“˜ GitHub Actions å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ³•æ•´ç†</h1>
<h2 id="_10">ğŸ“¦ ä»»å‹™èƒŒæ™¯</h2>
<p>é€é GitHub Actions è‡ªå‹•åŸ·è¡Œ sync_notion.py ä¸¦å°‡æ¯æ—¥ç­†è¨˜æ¨é€åˆ° GitHub ä¸Šï¼Œå¸¸è¦‹éŒ¯èª¤å¦‚ä¸‹ï¼š</p>
<h2 id="permission-denied-to-github-actionsbot">ğŸš« Permission denied to github-actions[bot]</h2>
<h3 id="_11">â— éŒ¯èª¤è¨Šæ¯ï¼š</h3>
<p>remote: Permission to <repo>.git denied to github-actions[bot].
fatal: unable to access 'https://github.com/<repo>.git/': The requested URL returned error: 403</p>
<h3 id="_12">âœ… åŸå› èˆ‡è§£æ³•ï¼š</h3>
<ul>
<li>
<p>åŸå› ï¼šé è¨­ github-actions[bot] ç„¡æ¬Š push åˆ°ç§äººæˆ–ç‰¹å®š repoã€‚</p>
</li>
<li>
<p>è§£æ³•ï¼šå»ºç«‹ Personal Access Tokenï¼ˆPATï¼‰ï¼Œä¸¦æ–°å¢ç‚º secretsï¼š</p>
</li>
</ul>
<h2 id="updates-were-rejected-because-the-remote-contains-work">ğŸ” Updates were rejected because the remote contains work</h2>
<h3 id="_13">â— éŒ¯èª¤è¨Šæ¯ï¼š</h3>
<p>Updates were rejected because the remote contains work that you do not have locally.</p>
<h3 id="_14">âœ… åŸå› èˆ‡è§£æ³•ï¼š</h3>
<ul>
<li>
<p>åŸå› ï¼šé ç«¯åˆ†æ”¯æœ‰æ›´æ–°ï¼Œä½†æœ¬åœ°åˆ†æ”¯å°šæœªåŒæ­¥ã€‚</p>
</li>
<li>
<p>è§£æ³• 1ï¼šè‹¥å¯æ¥å—è¦†è“‹ï¼š</p>
</li>
<li>
<p>è§£æ³• 2ï¼šè‹¥éœ€ä¿ç•™é ç«¯è®Šæ›´ï¼š</p>
</li>
</ul>
<h2 id="no-upstream-branch">ğŸ§ª No upstream branch</h2>
<h3 id="_15">â— éŒ¯èª¤è¨Šæ¯ï¼š</h3>
<p>fatal: The current branch main has no upstream branch.</p>
<h3 id="_16">âœ… è§£æ³•ï¼š</h3>
<p>git push --set-upstream origin main</p>
<h2 id="remote-url-token">ğŸ” ç„¡æ³•é©—è­‰ remote URL æœ‰å¥—ç”¨ Token</h2>
<h3 id="_17">ğŸ” é©—è­‰æ–¹æ³•ï¼š</h3>
<p>git remote -v</p>
<p>æ­£ç¢ºçµæœæ‡‰é¡ä¼¼ï¼š</p>
<p>origin  https://x-access-token:<GH_PAT>@github.com/<user>/<repo> (fetch)
origin  https://x-access-token:<GH_PAT>@github.com/<user>/<repo> (push)</p>
<h2 id="token">ğŸ”‘ Token é–‹é ­æ ¼å¼</h2>
<ul>
<li>
<p>Fine-grained Token ä¸€èˆ¬ç‚º github_pat_ é–‹é ­ï¼Œé€™æ˜¯æ­£å¸¸çš„ã€‚</p>
</li>
<li>
<p>è‹¥æ ¼å¼ç‚º ghp_ å‰‡ç‚º classic tokenã€‚</p>
</li>
</ul>
<h2 id="debug">ğŸ” Debug å»ºè­°</h2>
<p>ä½ å¯ä»¥å®‰å…¨å°å‡ºéƒ¨åˆ†è®Šæ•¸å€¼å”åŠ© debugï¼š</p>
<p>echo "GH_PAT starts with: ${GH_PAT:0:6}<strong>*</strong>*"
echo "REPO is $GITHUB_REPOSITORY"</p>
<h2 id="remote-force-push">âœ… å»ºè­°åšæ³•ï¼šé‡è¨­ Remote + Force Push</h2>
<p>git remote remove origin
git remote add origin https://x-access-token:${GH_PAT}@github.com/${GITHUB_REPOSITORY}
git push origin main --force</p>
<h2 id="_18">ğŸ§  è£œå……å»ºè­°</h2>
<ul>
<li>
<p>å¼·åˆ¶ push é¢¨éšªé«˜ï¼Œå»ºè­° æ¯æ—¥ç­†è¨˜è¨˜éŒ„å°ˆç”¨ branch ä½¿ç”¨ã€‚</p>
</li>
<li>
<p>è‹¥è¦é¿å… forceï¼Œå¯åœ¨ CI åŠ å…¥ git pull --rebase æˆ– fetch å†æ¯”å°ã€‚</p>
</li>
</ul>
    </article>
    <p class="post-meta">
      åŸæ–‡ï¼š
      <a href="https://github.com/Vincent23412/diary/blob/main/content/daily-notes/2025-06-03.md" target="_blank">GitHub</a> Â·
      <a href="https://raw.githubusercontent.com/Vincent23412/diary/main/content/daily-notes/2025-06-03.md" target="_blank">raw</a>
    </p>
  </main>

  <footer class="container py-24">
    <small>æœ€å¾Œæ›´æ–°ï¼š2026-02-09</small>
  </footer>
</body>
</html>
