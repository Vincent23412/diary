<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2025-07-04</title>
  <link rel="stylesheet" href="/notes/style.css" />
</head>
<body>
  <header class="container py-24">
    <h1 class="title">2025-07-04</h1>
    <nav class="nav">
      <a href="/notes/daily-notes/index.html" class="nav-link">â† å›åˆ†é¡</a>
      <a href="/notes/index.html" class="nav-link">å›ç¸½è¦½</a>
    </nav>
  </header>

  <main class="container card">
    <article class="post-content">
      <p>æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</p>
<p>ğŸ‘‰ C. Use Reserved Instances for the baseline capacity and use Spot Instances to handle additional capacity</p>
<p>ğŸ’¡ è§£é‡‹ï¼š</p>
<p>é€™é¡Œçš„é—œéµæ˜¯è¦æ‰¾å‡ºä¸€å€‹ é«˜å¯ç”¨ã€å…·æˆæœ¬æ•ˆç›Šï¼ˆMOST cost-effectiveï¼‰ çš„ EC2 é‹è¡Œæ¨¡å¼ï¼Œä¾†æ‡‰å°ï¼š</p>
<ul>
<li>
<p>æŒçºŒæ€§è™•ç†éœ€æ±‚ï¼ˆno downtimeï¼‰</p>
</li>
<li>
<p>ä¸ç©©å®šçš„è¨Šæ¯æµé‡ï¼ˆintermittent trafficï¼‰</p>
</li>
<li>
<p>å¯ä½µè¡Œè™•ç†ä»»å‹™ï¼ˆparallel processingï¼‰</p>
</li>
</ul>
<p>âœ… æœ€ä½³è§£æ³•ï¼š</p>
<p>Reserved + Spot çµ„åˆ</p>
<ul>
<li>
<p>Reserved Instances (RI)ï¼š</p>
</li>
<li></li>
<li>
<p>Spot Instancesï¼š</p>
</li>
<li></li>
</ul>
<p>è‹¥ Spot è¢«å›æ”¶ï¼ŒReserved ä»å¯ä¿åº•ç¶­æŒæœå‹™ä¸ä¸­æ–·ï¼Œæˆæœ¬æ•ˆç›Šèˆ‡å¯ç”¨æ€§å…¼å…·</p>
<p>âŒ å…¶ä»–é¸é …ç‚ºä»€éº¼ä¸é©åˆï¼Ÿ</p>
<p>âœ… æ­£ç¢ºç­”æ¡ˆï¼šC. Use Reserved Instances for the baseline capacity and use Spot Instances to handle additional capacity</p>
<p>æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</p>
<p>ğŸ‘‰ C. Create an Amazon EventBridge (Amazon CloudWatch Events) rule for the Createlmage API call. Configure the target as an Amazon Simple Notification Service (Amazon SNS) topic to send an alert when a Createlmage API call is detected.</p>
<p>âœ… è§£é‡‹ï¼š</p>
<p>ç‚ºä»€éº¼é¸ Cï¼Ÿ</p>
<ul>
<li>
<p>Amazon EventBridgeï¼ˆåŸå CloudWatch Eventsï¼‰ å¯ä»¥å³æ™‚ç›£è½ç‰¹å®šçš„ AWS API å‘¼å«äº‹ä»¶ï¼ˆä¾‹å¦‚ EC2 çš„ CreateImageï¼‰ã€‚</p>
</li>
<li>
<p>ä½ å¯ä»¥è¨­å®šè¦å‰‡ä¾†åµæ¸¬é€™å€‹ API äº‹ä»¶ï¼Œä¸¦å°‡äº‹ä»¶å‚³é€çµ¦ Amazon SNSï¼Œç™¼å‡ºé€šçŸ¥ï¼ˆä¾‹å¦‚ Emailã€SMSã€Lambda ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p>ä¸éœ€è¦è‡ªå·±æŸ¥ CloudTrail logã€å¯« Lambda åˆ†æç¨‹å¼æˆ–æ’ç¨‹ä»»å‹™ï¼Œè‡ªå‹•ä¸”é›¶ç¶­é‹è² æ“”ã€‚</p>
</li>
</ul>
<p>é€™æ˜¯ AWS å®˜æ–¹æ¨è–¦çš„æœ€è¼•é‡ã€æœ€å³æ™‚çš„äº‹ä»¶ç›£æ§æ–¹æ¡ˆã€‚</p>
<p>âŒ ç‚ºä»€éº¼å…¶ä»–é¸é …ä¸é©åˆï¼Ÿ</p>
<p>ğŸ§© å°è£œå……ï¼šEventBridge + SNS çš„å¥½è™•</p>
<ul>
<li>
<p>â± å³æ™‚åµæ¸¬ CreateImage</p>
</li>
<li>
<p>ğŸ“‰ æœ€å°é‹ç®—æˆæœ¬</p>
</li>
<li>
<p>ğŸ”§ å¹¾ä¹ç„¡é ˆç¨‹å¼ç¢¼</p>
</li>
<li>
<p>ğŸ“¬ æ”¯æ´å¤šç¨®é€šçŸ¥æ–¹å¼ï¼ˆEmailã€Lambdaã€HTTP ç­‰ï¼‰</p>
</li>
</ul>
<p>âœ… æ­£ç¢ºç­”æ¡ˆï¼šC. ä½¿ç”¨ EventBridge è¨­å®šç›£è½ Createlmageï¼Œä¸¦é€é SNS ç™¼é€è­¦å ±ã€‚</p>
<p>æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</p>
<p>ğŸ‘‰ B. Create a gateway VPC endpoint for Amazon S3 in the Availability Zone where the EC2 instance is located. Attach appropriate security groups to the endpoint. Attach a resource policy to the S3 bucket to only allow the EC2 instanceâ€™s IAM role for access.</p>
<p>âœ… è§£é‡‹ï¼š</p>
<p>å•é¡Œæ ¸å¿ƒéœ€æ±‚ï¼š</p>
<p>è³‡æ–™ä¸Šå‚³ä¸èƒ½ç¶“éå…¬ç¶²ï¼ˆNo public internet routesï¼‰</p>
<p>åªæœ‰ EC2 instance æ‰èƒ½ä¸Šå‚³</p>
<p>ç›®æ¨™æœå‹™æ˜¯ Amazon S3</p>
<p>ğŸ§© æœ€é©è§£ï¼š</p>
<p>Gateway VPC Endpoint + IAM Role é™åˆ¶</p>
<ul>
<li>
<p>Gateway VPC Endpoint æ˜¯ S3 èˆ‡ DynamoDB å°ˆç”¨çš„ VPC Endpointï¼Œå…è¨± EC2 èˆ‡ S3 é–“çš„é€šè¨Šèµ°å…§éƒ¨ AWS ç¶²è·¯ï¼ˆç„¡éœ€ NAT Gateway æˆ– Internet Gatewayï¼‰ã€‚</p>
</li>
<li>
<p>æ­é… S3 Bucket Policy é™å®šåªæœ‰ç‰¹å®š IAM Roleï¼ˆä¹Ÿå°±æ˜¯ EC2 çš„ instance profileï¼‰èƒ½ä¸Šå‚³ã€‚</p>
</li>
</ul>
<p>é€™ç¨®è¨­è¨ˆï¼š</p>
<ul>
<li>
<p>ä¸ç¶“éå…¬ç¶²</p>
</li>
<li>
<p>æˆæœ¬æœ€ä½ï¼ˆä¸ç”¨ NATï¼‰</p>
</li>
<li>
<p>æ˜“æ–¼ç®¡æ§èˆ‡ç¶­é‹</p>
</li>
</ul>
<p>âŒ ç‚ºä»€éº¼å…¶ä»–é¸é …ä¸å°ï¼Ÿ</p>
<p>ğŸ” å®‰å…¨æ€§è£œå……å»ºè­°ï¼š</p>
<ul>
<li>
<p>åœ¨ S3 Bucket Policy åŠ å…¥ï¼š</p>
</li>
<li></li>
</ul>
<p>âœ… æ­£ç¢ºç­”æ¡ˆï¼šB. ä½¿ç”¨ Gateway VPC Endpoint æ­é… IAM Role é™åˆ¶ï¼Œç¢ºä¿å®‰å…¨èˆ‡ç§æœ‰é€šè¨Šã€‚</p>
<p>ğŸŒ‰ Gateway Endpoint vs. Interface Endpoint å·®ç•°ç¸½è¦½</p>
<p>ğŸ” æ›´å…·é«”ç¯„ä¾‹æ¯”è¼ƒ</p>
<p>Gateway Endpoint</p>
<p>ï¼ˆå¦‚ S3ï¼‰ï¼š</p>
<ul>
<li>
<p>ä½ å»ºç«‹ä¸€å€‹ Gateway Endpoint</p>
</li>
<li>
<p>å®ƒæœƒå¹«ä½ åœ¨ Route Table ä¸­è‡ªå‹•åŠ å…¥ä¸€æ¢è·¯ç”±ï¼š</p>
</li>
</ul>
<p>Destination: pl-xxxx (S3 Prefix List) â†’ Target: vpce-xxxx</p>
<ul>
<li></li>
<li>
<p>åªè¦ EC2 åœ¨é€™å€‹ Subnet ä¸­ï¼Œè«‹æ±‚ s3.amazonaws.com æœƒè‡ªå‹•èµ°ç§ç¶²ã€‚</p>
</li>
</ul>
<p>Interface Endpoint</p>
<p>ï¼ˆå¦‚ SQSï¼‰ï¼š</p>
<ul>
<li>
<p>å»ºç«‹æ™‚æœƒåœ¨ Subnet ä¸­ç”Ÿæˆä¸€å€‹ ENIï¼ˆå½ˆæ€§ç¶²å¡ï¼‰</p>
</li>
<li>
<p>æ‰€æœ‰è«‹æ±‚æœƒå°å‘é€™å€‹ ENIï¼Œä¾‹å¦‚ï¼š</p>
</li>
</ul>
<p>sqs.ap-northeast-1.vpce.amazonaws.com â†’ 10.0.2.35ï¼ˆENI IPï¼‰</p>
<ul>
<li></li>
<li>
<p>å¯ä»¥ç”¨ Security Group æ§ç®¡èª°å¯ä»¥å­˜å–å®ƒ</p>
</li>
</ul>
<p>âœ… ä»€éº¼æ™‚å€™ç”¨å“ªå€‹ï¼Ÿ</p>
<p>ğŸ“Œ ç¸½çµ</p>
<p>æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</p>
<p>ğŸ‘‰ A. Configure the Lambda function to run in the VPC with the appropriate security group.</p>
<p>âœ… è§£é‡‹ï¼š</p>
<p>å•é¡Œé—œéµï¼š</p>
<ul>
<li>
<p>Lambda è¦å­˜å– åœ¨å…¬å¸è³‡æ–™ä¸­å¿ƒï¼ˆon-premisesï¼‰å…§éƒ¨ç§æœ‰å­ç¶²ä¸­çš„è³‡æ–™åº«</p>
</li>
<li>
<p>AWS èˆ‡è³‡æ–™ä¸­å¿ƒä¹‹é–“å·²é€é Direct Connect å»ºç«‹é€£ç·š</p>
</li>
<li>
<p>è¦æ±‚ Lambda å¯ä»¥é€éç§æœ‰ç¶²è·¯ï¼ˆéå…¬ç¶²ï¼‰å­˜å–è³‡æ–™åº«</p>
</li>
</ul>
<p>âœ… ç‚ºä»€éº¼é¸ Aï¼Ÿ</p>
<ul>
<li>
<p>Lambda é è¨­é‹è¡Œåœ¨ AWS å…¬ç¶²ä¸­ï¼Œå¦‚æœè¦å­˜å–ç§æœ‰ç¶²æ®µï¼ˆVPC å­ç¶²ã€æˆ–é€é Direct Connect é€£åˆ° on-premï¼‰ï¼Œå¿…é ˆé…ç½® Lambda é‹è¡Œåœ¨ VPC ä¸­</p>
</li>
<li>
<p>è¨­å®š Lambda çš„ VPC å­ç¶²èˆ‡å®‰å…¨ç¾¤çµ„ï¼Œå°±èƒ½è®“ Lambdaï¼š</p>
</li>
<li></li>
<li>
<p>å®Œå…¨ç¬¦åˆç„¡ä¼ºæœå™¨ + ç§ç¶²å­˜å–çš„æ¶æ§‹éœ€æ±‚</p>
</li>
</ul>
<p>âŒ å…¶ä»–é¸é …ç‚ºä»€éº¼ä¸é©åˆï¼Ÿ</p>
<p>ğŸ§© è£œå……å»ºè­°ï¼š</p>
<p>è‹¥ Lambda æ˜¯å­˜å– è³‡æ–™ä¸­å¿ƒå…§éƒ¨çš„ç§æœ‰è³‡æ–™åº«ï¼Œä½ éœ€è¦ï¼š</p>
<p>è®“ Lambda åŠ å…¥ VPCï¼ˆé¸å®šæœ‰è·¯ç”±åˆ° VGW çš„ç§æœ‰å­ç¶²ï¼‰</p>
<p>è¨­å®š Lambda ä½¿ç”¨çš„ security group â†’ é–‹å•Ÿå°è³‡æ–™åº«çš„é€£ç·šæ¬Šé™ï¼ˆä¾‹å¦‚ TCP 3306 for MySQLï¼‰</p>
<p>ç¢ºä¿ VPC route table æœ‰æŒ‡å‘ Virtual Private Gatewayï¼ˆVGWï¼‰</p>
<p>ç¢ºä¿å°æ–¹è³‡æ–™ä¸­å¿ƒçš„é˜²ç«ç‰†èˆ‡è·¯ç”±è¨­å®šä¹Ÿå…è¨± Lambda çš„ VPC IP ç¯„åœé€²å…¥</p>
    </article>
    <p class="post-meta">
      åŸæ–‡ï¼š
      <a href="https://github.com/Vincent23412/diary/blob/main/content/daily-notes/2025-07-04.md" target="_blank">GitHub</a> Â·
      <a href="https://raw.githubusercontent.com/Vincent23412/diary/main/content/daily-notes/2025-07-04.md" target="_blank">raw</a>
    </p>
  </main>

  <footer class="container py-24">
    <small>æœ€å¾Œæ›´æ–°ï¼š2025-12-14</small>
  </footer>
</body>
</html>
